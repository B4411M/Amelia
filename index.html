<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amelia AI - B41M Smart Router</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .app-container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
        }

        .brand-text h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .brand-text p {
            font-size: 14px;
            color: #64748b;
            margin: 0;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: #64748b;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .status-dot.ready { background: #10b981; box-shadow: 0 0 10px #10b981; }
        .status-dot.loading { background: #f59e0b; animation: pulse 1s infinite; }
        .status-dot.idle { background: #64748b; }
        .status-dot.error { background: #ef4444; }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.9); }
        }

        .stats-indicator {
            display: flex;
            gap: 8px;
            font-size: 11px;
            background: #f8fafc;
            padding: 6px 12px;
            border-radius: 20px;
        }

        .stats-indicator span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stats-indicator .local { color: #10b981; }
        .stats-indicator .puter { color: #667eea; }
        .stats-indicator .cache { color: #f59e0b; }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .welcome-screen {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 30px;
            text-align: center;
        }

        .welcome-content {
            max-width: 500px;
        }

        .welcome-logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            font-weight: bold;
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1e293b;
        }

        .welcome-description {
            font-size: 18px;
            color: #64748b;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
        }

        .suggestion-chip {
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 14px;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .suggestion-chip:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 30px;
            display: none;
        }

        .chat-messages.active {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .message.local .message-avatar {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.5;
            position: relative;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message.ai .message-content,
        .message.local .message-content {
            background: #f8fafc;
            color: #1e293b;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 6px;
        }

        .source-badge {
            position: absolute;
            bottom: -8px;
            right: 10px;
            font-size: 9px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
        }

        .source-badge.puter { background: #667eea; color: white; }
        .source-badge.local { background: #10b981; color: white; }
        .source-badge.cache { background: #f59e0b; color: white; }
        .source-badge.fallback { background: #64748b; color: white; }

        .loading-indicator {
            display: none;
            align-items: center;
            gap: 12px;
            padding: 20px 30px;
        }

        .loading-indicator.active {
            display: flex;
        }

        .typing-animation {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #94a3b8;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .loading-text {
            font-size: 14px;
            color: #64748b;
        }

        .input-container {
            background: white;
            border-top: 1px solid #e2e8f0;
            padding: 20px 30px;
        }

        .input-wrapper {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            position: relative;
        }

        #messageInput {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 16px;
            font-family: inherit;
            resize: none;
            max-height: 120px;
            min-height: 50px;
            transition: border-color 0.2s ease;
        }

        #messageInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        #messageInput::placeholder {
            color: #94a3b8;
        }

        .send-button {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .footer-note {
            text-align: center;
            margin-top: 10px;
            font-size: 12px;
            color: #94a3b8;
        }

        .smart-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            padding: 4px 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
            margin-left: 8px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .app-container { height: 95vh; max-height: none; }
            .header { padding: 15px 20px; }
            .brand-text h1 { font-size: 20px; }
            .welcome-screen { padding: 30px 20px; }
            .welcome-title { font-size: 24px; }
            .welcome-description { font-size: 16px; }
            .chat-messages { padding: 15px 20px; }
            .message-content { max-width: 85%; }
            .input-container { padding: 15px 20px; }
            .stats-indicator { display: none; }
        }

        /* Scrollbar */
        .chat-messages::-webkit-scrollbar { width: 6px; }
        .chat-messages::-webkit-scrollbar-track { background: transparent; }
        .chat-messages::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 3px; }
        .chat-messages::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }

        /* Message formatting */
        .message-content h1, .message-content h2, .message-content h3 { margin: 0 0 8px 0; font-weight: 600; }
        .message-content h1 { font-size: 1.2em; }
        .message-content h2 { font-size: 1.1em; }
        .message-content h3 { font-size: 1em; }
        .message-content p { margin: 0 0 8px 0; }
        .message-content p:last-child { margin-bottom: 0; }
        .message-content code { background: rgba(0,0,0,0.1); padding: 2px 4px; border-radius: 3px; font-family: monospace; }
        .message-content pre { background: #f1f5f9; padding: 12px; border-radius: 6px; overflow-x: auto; margin: 8px 0; }
        .message-content pre code { background: none; padding: 0; }
        .message-content ul { margin: 8px 0; padding-left: 20px; }
        .message-content li { margin: 4px 0; }
        .message-content blockquote { border-left: 4px solid #667eea; margin: 8px 0; padding: 8px 16px; background: rgba(102,126,234,0.1); }
        .message-content a { color: #667eea; }
        .message.user .message-content code { background: rgba(255,255,255,0.2); }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="logo-section">
                <div class="logo">A</div>
                <div class="brand-text">
                    <h1>Amelia AI <span class="smart-badge">üß† Smart Router</span></h1>
                    <p>By : B41M</p>
                </div>
            <div class="status">
                <div class="stats-indicator">
                    <span class="local">‚ö° Local: <b id="localCount">0</b></span>
                    <span class="puter">üß† Puter: <b id="puterCount">0</b></span>
                    <span class="cache">üíæ Cache: <b id="cacheCount">0</b></span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div class="status-dot idle" id="statusDot"></div>
                    <span id="statusText">Ready</span>
                </div>
        </header>

        <main class="main-content">
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-content">
                    <div class="welcome-logo">A</div>
                    <h2 class="welcome-title">Amelia AI Smart Router</h2>
                    <p class="welcome-description" id="welcomeDescription">
                        Saya siap membantu! Saya akan menggunakan respons lokal untuk pertanyaan sederhana 
                        dan Puter.js untuk pertanyaan kompleks. Ini membantu menghemat API limit.
                    </p>
                    <div class="suggestion-chips" id="suggestionChips" style="display: flex;">
                        <button class="suggestion-chip" onclick="useSuggestion('Halo, apa kabar?')">
                            üëã Halo
                        </button>
                        <button class="suggestion-chip" onclick="useSuggestion('Berapa 15 + 27?')">
                            üî¢ Matematika
                        </button>
                        <button class="suggestion-chip" onclick="useSuggestion('Jam berapa sekarang?')">
                            ‚è∞ Waktu
                        </button>
                        <button class="suggestion-chip" onclick="useSuggestion('Jelaskan tentang Machine Learning')">
                            üìö AI Info
                        </button>
                    </div>
            </div>

            <div class="chat-messages" id="chatMessages"></div>

            <div class="loading-indicator" id="loadingIndicator">
                <div class="typing-animation">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                <span class="loading-text" id="loadingText">AI sedang berpikir...</span>
            </div>
        </main>

        <footer class="input-container">
            <div class="input-wrapper">
                <div class="input-field">
                    <textarea 
                        id="messageInput" 
                        placeholder="Tanyakan apa saja... (respons lokal untuk pertanyaan sederhana)" 
                        rows="1"
                    ></textarea>
                </div>
                <button class="send-button" id="sendButton" onclick="sendMessage()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"/>
                        <polygon points="22,2 15,22 11,13 2,9"/>
                    </svg>
                </button>
            </div>
            <div class="footer-note">
                Powered by B41M - Smart Routing: Local + Puter.js + Cache
            </div>
        </footer>
    </div>

    <!-- ============================================ -->
    <!-- SMART ROUTING SCRIPTS -->
    <!-- ============================================ -->
    
    <!-- Load Smart Router Scripts -->
    <script src="scripts/smart-router.js"></script>
    <script src="scripts/cache-manager.js"></script>
    <script src="scripts/lazy-puter.js"></script>
    <script src="scripts/orchestrator.js"></script>

    <!-- Knowledge Base -->
    <script>
        window.KNOWLEDGE_BASE = {
            currentDate: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
            systemInfo: {
                version: "Amelia AI v2.2.0 Smart Router",
                lastUpdate: new Date().toISOString(),
                knowledgeCutoff: "December 2025",
                creator: "B41M"
            },
            getEnhancedContext() {
                return `Current Date: ${this.currentDate}\nVersion: ${this.systemInfo.version}\nKnowledge Cutoff: ${this.systemInfo.knowledgeCutoff}`;
            }
        };
    </script>

    <!-- Main Application -->
    <script>
        class AmeliaSmartAI {
            constructor() {
                this.chatMessages = document.getElementById('chatMessages');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.loadingIndicator = document.getElementById('loadingIndicator');
                this.loadingText = document.getElementById('loadingText');
                this.welcomeScreen = document.getElementById('welcomeScreen');
                this.welcomeDescription = document.getElementById('welcomeDescription');
                this.statusDot = document.getElementById('statusDot');
                this.statusText = document.getElementById('statusText');
                
                this.isLoading = false;
                this.orchestrator = null;
                
                this.init();
            }
            
            async init() {
                this.updateStatus('loading', 'Initializing Smart Router...');
                
                try {
                    // Initialize orchestrator
                    this.orchestrator = new AmeliaOrchestrator();
                    await this.orchestrator.init();
                    
                    this.updateStatus('ready', 'Ready');
                    this.enableChat();
                    
                    console.log('‚úÖ Amelia Smart Router initialized!');
                    
                } catch (error) {
                    console.error('Initialization error:', error);
                    this.updateStatus('ready', 'Ready (Offline Mode)');
                    this.enableChat();
                }
                
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                this.sendButton.addEventListener('click', () => this.sendMessage());
                
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                
                this.messageInput.addEventListener('input', () => {
                    this.updateSendButton();
                    this.autoResize();
                });
            }
            
            updateStatus(type, text) {
                this.statusDot.className = 'status-dot ' + type;
                this.statusText.textContent = text;
            }
            
            enableChat() {
                this.messageInput.disabled = false;
                this.updateSendButton();
                this.messageInput.focus();
            }
            
            async sendMessage() {
                const message = this.messageInput.value.trim();
                if (!message || this.isLoading) return;
                
                if (this.welcomeScreen.style.display !== 'none') {
                    this.welcomeScreen.style.display = 'none';
                    this.chatMessages.classList.add('active');
                }
                
                this.addMessage(message, 'user');
                this.messageInput.value = '';
                this.updateSendButton();
                this.autoResize();
                
                this.showLoading();
                
                try {
                    // Process dengan smart orchestrator
                    const result = await this.orchestrator.processMessage(message);
                    
                    if (result.success) {
                        this.addMessageWithSource(result.response, result.source, result.category);
                        this.updateStats();
                    } else {
                        this.addMessage('Maaf, terjadi kesalahan. Silakan coba lagi.', 'ai');
                    }
                    
                } catch (error) {
                    console.error('AI Error:', error);
                    this.addMessage('Maaf, saya sedang mengalami gangguan. Silakan coba lagi.', 'ai');
                } finally {
                    this.hideLoading();
                }
            }
            
            addMessage(content, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.dataset.content = content;
                
                const avatar = document.createElement('div');
                avatar.className = 'message-avatar';
                avatar.textContent = sender === 'user' ? 'U' : 'A';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.innerHTML = this.formatMessage(content);
                
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(contentDiv);
                
                this.chatMessages.appendChild(messageDiv);
                this.scrollToBottom();
            }
            
            addMessageWithSource(content, source, category) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message ai';
                messageDiv.dataset.content = content;
                
                const avatar = document.createElement('div');
                avatar.className = 'message-avatar';
                avatar.textContent = 'A';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.innerHTML = this.formatMessage(content);
                
                // Add source badge
                const sourceBadge = document.createElement('span');
                sourceBadge.className = `source-badge ${source.split(' ')[0]}`;
                sourceBadge.textContent = this.getSourceLabel(source);
                contentDiv.appendChild(sourceBadge);
                
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(contentDiv);
                
                this.chatMessages.appendChild(messageDiv);
                this.scrollToBottom();
            }
            
            getSourceLabel(source) {
                if (source.includes('cache')) return 'üíæ Cache';
                if (source.includes('local')) return '‚ö° Local';
                if (source.includes('puter')) return 'üß† Puter';
                if (source.includes('fallback')) return 'üîÑ Fallback';
                return 'ü§ñ AI';
            }
            
            formatMessage(content) {
                return content
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code>$1</code>')
                    .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
                    .replace(/\n/g, '<br>');
            }
            
            showLoading() {
                this.isLoading = true;
                this.loadingIndicator.classList.add('active');
                this.loadingText.textContent = 'Sedang memproses...';
                this.scrollToBottom();
            }
            
            hideLoading() {
                this.isLoading = false;
                this.loadingIndicator.classList.remove('active');
            }
            
            updateSendButton() {
                const hasContent = this.messageInput.value.trim().length > 0;
                this.sendButton.disabled = !hasContent || this.isLoading;
            }
            
            autoResize() {
                this.messageInput.style.height = 'auto';
                this.messageInput.style.height = Math.min(this.messageInput.scrollHeight, 120) + 'px';
            }
            
            scrollToBottom() {
                setTimeout(() => {
                    this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
                }, 100);
            }
            
            updateStats() {
                if (!this.orchestrator) return;
                
                const stats = this.orchestrator.getStats();
                document.getElementById('localCount').textContent = stats.messages.local;
                document.getElementById('puterCount').textContent = stats.messages.puter;
                document.getElementById('cacheCount').textContent = stats.messages.cacheHits;
            }
        }
        
        // Global functions
        function sendMessage() {
            if (window.ameliaAI) window.ameliaAI.sendMessage();
        }
        
        function useSuggestion(text) {
            if (window.ameliaAI) {
                window.ameliaAI.messageInput.value = text;
                window.ameliaAI.sendMessage();
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Amelia AI Smart Router Starting...');
            window.ameliaAI = new AmeliaSmartAI();
            console.log('‚úÖ Smart Router Ready!');
        });
    </script>
</body>
</html>
